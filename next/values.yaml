# このチャートで使う、変更可能な設定値をここにまとめるんや

replicaCount: 1 # ★ 5から1に変更（DBと競合しないよう、最初は1推奨）

image:
  repository: rnagashiro/my-nextjs-app # CI/CDがビルドしたDockerイメージのリポジトリ
  pullPolicy: IfNotPresent
  # tagはCI/CDパイプライン（GitHub Actions）が自動で書き換えるから、空っぽでもええで
  tag: "8f21e45"
service:
  type: ClusterIP
  port: 3000 # Next.jsアプリがリッスンするポート

# ★ アプリケーション用の環境変数
app:
  env:
    cookieName: "session-infopia"
    emailServerUser: "ainfopiaf6@gmail.com"
    emailFrom: "ainfopiaf6@gmail.com"
    nextPublicBaseUrl: "https://infopia.nqg1t0.com"
  # ★ Secretとして管理する環境変数
  secretEnv:
    secretCookiePassword: "X6AkaVa549jDzArdMNJudPeXTXjnZthc" # ★ 本番ではVaultやArgoCD Secretで管理推奨
    emailServerPassword: "vvurlxuidngagqae"            # ★ 本番ではVaultやArgoCD Secretで管理推奨

# PostgreSQLの設定
postgresql:
  image: "postgres:15"
  auth:
    username: "user"
    database: "mydatabase" # ★ mydabase から mydatabase に修正
    password: "your-super-secret-password" # ★ CI/CDなどで上書きする
  storage:
    size: 1Gi
    storageClassName: "local-path"

# Ingress（外部からの入口）の設定
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: infopia.nqg1t0.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: my-nextjs-app-tls
      hosts:
        - infopia.nqg1t0.com

# DBマイグレーションJobの設定
migration:
  enabled: true
  image:
    repository: rnagashiro/my-nextjs-app # アプリ本体と同じイメージ
    tagSuffix: ""                      # アプリ本体と同じタグを使う
  # ★ 実行するコマンド
  command: ["npx", "prisma", "migrate", "deploy"]